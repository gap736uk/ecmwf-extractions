"""
ftp_tmp.py
==========

Template file for FTP section of job

"""

ftp_commands=[]
ftp_commands.append("#")
ftp_commands.append("# This section creates a loop around the FTP")
ftp_commands.append("# command so that if the number of files in this")
ftp_commands.append("# directory is longer than the glob limit it will")
ftp_commands.append("# move them out 1000 at a time and FTP them from ")
ftp_commands.append("# another directory")
ftp_commands.append("#")
ftp_commands.append("")
ftp_commands.append("# Initialise file list and length of it")
ftp_commands.append("file_list=`ls`")
ftp_commands.append("num_of_files=`ls | wc -w`")
ftp_commands.append("")
ftp_commands.append("while [ $num_of_files -gt 0 ]")
ftp_commands.append("  do")
ftp_commands.append("  # Set maximum number of files to glob")
ftp_commands.append("  num=1000")
ftp_commands.append("  # Get current length of file list")
ftp_commands.append("  len=` echo $file_list | wc -w `")
ftp_commands.append("  if [ $len -lt $num ]   # If less than glob limit FTP all")
ftp_commands.append("    then")
ftp_commands.append("    next_1000_files=$file_list")
ftp_commands.append("    file_list=""")
ftp_commands.append("  else                   # otherwise get first 1000 files")
ftp_commands.append("    next_1000_files=` echo $file_list | cut -d\" \" -f1-$num `")
ftp_commands.append("    file_list=` echo $file_list | cut -d\" \" -f$num- `")
ftp_commands.append("  fi")
ftp_commands.append("  num_of_files=` echo $file_list | wc -w ` ")
ftp_commands.append("  ")
ftp_commands.append("  # Now move the files to a temporary dir")
ftp_commands.append("  # and FTP across")
ftp_commands.append("  mkdir ftp_1000")
ftp_commands.append("  mv $next_1000_files ftp_1000")
ftp_commands.append("  cd ftp_1000")
ftp_commands.append("    ")
ftp_commands.append("  # Now do the FTPing")
ftp_commands.append("  ftp -n ftp-gw.ecmwf.int <<EOF")
ftp_commands.append("    user badc\@tornado.badc.rl.ac.uk rain&h@il")
ftp_commands.append("    cd DELIVERIES_DIR")
ftp_commands.append("    cd TARGET_DIR  ")
ftp_commands.append("    umask 037")
ftp_commands.append("    bin")
ftp_commands.append("    mput *")
ftp_commands.append("    quit")
ftp_commands.append("EOF")
ftp_commands.append("  ")
ftp_commands.append("  # Now delete those files that have been FTPed")
ftp_commands.append("  cd ..")
ftp_commands.append("  rm -fR ftp_1000")
ftp_commands.append("  ")
ftp_commands.append("done")
